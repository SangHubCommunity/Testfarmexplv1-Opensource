repeat task.wait() until game:IsLoaded()
if game.CoreGui:FindFirstChild("BFAuto") then game.CoreGui.BFAuto:Destroy() end

local plr = game.Players.LocalPlayer
local ts = game:GetService("TweenService")
local vim = game:GetService("VirtualInputManager")
local rep = game:GetService("ReplicatedStorage")

-- GUI chính và nút toggle GUI
local mainGui = Instance.new("ScreenGui", game.CoreGui)
mainGui.Name = "BFAuto"

local toggleBtn = Instance.new("TextButton", mainGui)
toggleBtn.Size = UDim2.new(0, 100, 0, 30)
toggleBtn.Position = UDim2.new(0, 10, 0.85, 0)
toggleBtn.Text = "Toggle GUI"
toggleBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 14
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(0, 8)

-- GUI chính mở rộng bo góc hình chữ nhật (60% màn hình)
local gui = Instance.new("Frame", mainGui)
gui.Size = UDim2.new(0.6, 0, 0.6, 0)
gui.Position = UDim2.new(0.2, 0, 0.2, 0)
gui.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
gui.BorderSizePixel = 0
gui.Active = true
gui.Draggable = true
Instance.new("UICorner", gui).CornerRadius = UDim.new(0, 14)

toggleBtn.MouseButton1Click:Connect(function()
    gui.Visible = not gui.Visible
end)

-- Hàm tạo button
local function CreateButton(text, posY)
	local btn = Instance.new("TextButton", gui)
	btn.Size = UDim2.new(0, 180, 0, 30)
	btn.Position = UDim2.new(0, 20, 0, posY)
	btn.Text = text
	btn.BackgroundColor3 = Color3.fromRGB(50, 120, 200)
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 14
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
	return btn
end

-- Các button chức năng
local btnFarm = CreateButton("Auto Farm: OFF", 10)
local btnESP = CreateButton("ESP Người Chơi: OFF", 50)
local btnFruitESP = CreateButton("ESP Trái: OFF", 90)
local btnCollect = CreateButton("Auto Collect Trái: OFF", 130)

-- Biến toggle
local autoFarm, espOn, fruitESPOn, autoCollect = false, false, false, false

btnFarm.MouseButton1Click:Connect(function()
	autoFarm = not autoFarm
	btnFarm.Text = autoFarm and "Auto Farm: ON" or "Auto Farm: OFF"
end)

btnESP.MouseButton1Click:Connect(function()
	espOn = not espOn
	btnESP.Text = espOn and "ESP Người Chơi: ON" or "ESP Người Chơi: OFF"
end)

btnFruitESP.MouseButton1Click:Connect(function()
	fruitESPOn = not fruitESPOn
	btnFruitESP.Text = fruitESPOn and "ESP Trái: ON" or "ESP Trái: OFF"
end)

btnCollect.MouseButton1Click:Connect(function()
	autoCollect = not autoCollect
	btnCollect.Text = autoCollect and "Auto Collect Trái: ON" or "Auto Collect Trái: OFF"
end)
-- Hàm tạo ESP
local function CreateESP(part, name, color, tagName)
	local tag = Instance.new("BillboardGui", part)
	tag.Name = tagName
	tag.Size = UDim2.new(0, 100, 0, 40)
	tag.StudsOffset = Vector3.new(0, 2, 0)
	tag.AlwaysOnTop = true

	local txt = Instance.new("TextLabel", tag)
	txt.Size = UDim2.new(1, 0, 1, 0)
	txt.Text = name
	txt.TextColor3 = color
	txt.TextSize = 10
	txt.BackgroundTransparency = 1
end

-- ESP + Auto Collect Loop
task.spawn(function()
	while task.wait(1) do
		-- ESP người chơi
		for _, pl in pairs(game.Players:GetPlayers()) do
			if pl ~= plr and pl.Character and pl.Character:FindFirstChild("Head") then
				local head = pl.Character.Head
				if espOn and not head:FindFirstChild("ESP") then
					CreateESP(head, pl.Name, Color3.fromRGB(0, 255, 0), "ESP")
				elseif not espOn and head:FindFirstChild("ESP") then
					head.ESP:Destroy()
				end
			end
		end

		-- ESP trái + Auto Collect
		for _, v in pairs(workspace:GetChildren()) do
			if v:IsA("Tool") and v:FindFirstChild("Handle") and v.Handle:FindFirstChild("TouchInterest") then
				if fruitESPOn and not v:FindFirstChild("FruitESP") then
					CreateESP(v, v.Name, Color3.fromRGB(255, 0, 0), "FruitESP")
				elseif not fruitESPOn and v:FindFirstChild("FruitESP") then
					v.FruitESP:Destroy()
				end

				-- Auto collect khi ở gần
				if autoCollect and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
					if (v.Position - plr.Character.HumanoidRootPart.Position).Magnitude < 50 then
						firetouchinterest(plr.Character.HumanoidRootPart, v.Handle, 0)
						firetouchinterest(plr.Character.HumanoidRootPart, v.Handle, 1)
					end
				end
			end
		end
	end
end)

-- Auto Haki bật vĩnh viễn
task.spawn(function()
	while task.wait(5) do
		pcall(function()
			rep.Remotes.CommE:FireServer("Buso")
		end)
	end
end)

-- Auto click liên tục
task.spawn(function()
	while task.wait(0.2) do
		if autoFarm then
			vim:SendMouseButtonEvent(0, 0, 0, true, game, 0)
			task.wait()
			vim:SendMouseButtonEvent(0, 0, 0, false, game, 0)
		end
	end
end)
-- Danh sách vị trí farm Sea 1
getgenv().BF_LevelFarm = {
	[1] = {Quest="BanditQuest1",Mob="Bandit",Pos=Vector3.new(1060,17,1547),QuestPos=Vector3.new(1060,17,1545)},
	[10] = {Quest="JungleQuest",Mob="Monkey",Pos=Vector3.new(-1602,36,153),QuestPos=Vector3.new(-1602,36,155)},
	[15] = {Quest="JungleQuest",Mob="Gorilla",Pos=Vector3.new(-1175,40,389),QuestPos=Vector3.new(-1602,36,155)},
	[30] = {Quest="BuggyQuest1",Mob="Pirate",Pos=Vector3.new(-484,23,2302),QuestPos=Vector3.new(-1144,5,3829)},
	[40] = {Quest="BuggyQuest1",Mob="Brute",Pos=Vector3.new(-365,38,2765),QuestPos=Vector3.new(-1144,5,3829)},
	[55] = {Quest="BuggyQuest2",Mob="Bobby",Pos=Vector3.new(-456,23,3406),QuestPos=Vector3.new(-1144,5,3829)},
	[60] = {Quest="DesertQuest",Mob="Desert Bandit",Pos=Vector3.new(932,6,4483),QuestPos=Vector3.new(896,7,4389)},
	-- Thêm các đảo khác tiếp tục nếu muốn full
}

-- Tìm thông tin đảo theo level
local function GetTarget()
	local level = plr.Data.Level.Value
	local last
	for l, v in pairs(getgenv().BF_LevelFarm) do
		if level >= l then
			last = v
		end
	end
	return last
end

-- Tween mượt + block ảo dưới chân
local function TweenTo(pos)
	local hrp = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
	if not hrp then return end

	-- Tạo block ảo đỡ chân
	local pad = workspace:FindFirstChild("TweenPad") or Instance.new("Part", workspace)
	pad.Name = "TweenPad"
	pad.Anchored = true
	pad.CanCollide = true
	pad.Size = Vector3.new(10, 1, 10)
	pad.Transparency = 1
	pad.Position = hrp.Position - Vector3.new(0, 4, 0)

	local dist = (hrp.Position - pos).Magnitude
	local tween = ts:Create(hrp, TweenInfo.new(dist / 300, Enum.EasingStyle.Linear), {CFrame = CFrame.new(pos)})
	tween:Play()
	tween.Completed:Wait()
end

-- Hệ thống farm chính
task.spawn(function()
	local lastMob = nil
	local farming = false

	while task.wait() do
		if autoFarm and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
			local data = GetTarget()
			if not data then continue end

			local hrp = plr.Character.HumanoidRootPart
			hrp.Anchored = false

			-- Bay tới đảo
			TweenTo(data.Pos)
			task.wait(0.5)
			farming = true

			-- Tạo block đỡ
			local plat = workspace:FindFirstChild("BFPlat") or Instance.new("Part", workspace)
			plat.Name = "BFPlat"
			plat.Anchored = true
			plat.CanCollide = true
			plat.Size = Vector3.new(10, 1, 10)
			plat.Transparency = 1
			plat.Position = data.Pos - Vector3.new(0, 3, 0)

			-- Nhận nhiệm vụ nếu chưa có
			local questUI = plr.PlayerGui:FindFirstChild("Main") and plr.PlayerGui.Main:FindFirstChild("Quest")
			local hasQuest = questUI and questUI.Visible
			if not hasQuest then
				TweenTo(data.QuestPos)
				task.wait(0.5)
				rep.Remotes.CommF_:InvokeServer("StartQuest", data.Quest, 1)
				task.wait(1)
			end

			-- Farm loop
			for _, mob in pairs(workspace.Enemies:GetChildren()) do
				if mob.Name == data.Mob and mob:FindFirstChild("HumanoidRootPart") and mob.Humanoid.Health > 0 then
					lastMob = mob
					local root = mob.HumanoidRootPart

					-- Sửa hitbox
					for _, v in ipairs(mob:GetChildren()) do
						if v:IsA("BasePart") then
							v.Size = Vector3.new(60, 60, 60)
							v.Transparency = 0.2
						end
					end

					-- Ghim trên đầu quái
					local high = root.Position + Vector3.new(0, 10, 0)
					local anchor = Instance.new("Part", root)
					anchor.Anchored = true
					anchor.Transparency = 1
					anchor.CanCollide = true
					anchor.Size = Vector3.new(8, 1, 8)
					anchor.Position = high

					-- Đánh tới khi quái chết
					repeat
						TweenTo(high + Vector3.new(0, 2, 0))
						task.wait(0.1)
					until not autoFarm or not mob or mob.Humanoid.Health <= 0

					break
				end
			end
		else
			farming = false
			if workspace:FindFirstChild("BFPlat") then workspace.BFPlat:Destroy() end
			if workspace:FindFirstChild("TweenPad") then workspace.TweenPad:Destroy() end
		end
	end
end)
-- GUI chính
local mainGui = Instance.new("ScreenGui", game.CoreGui)
mainGui.Name = "BFAuto"

-- Nút bật/tắt GUI
local toggleBtn = Instance.new("TextButton", mainGui)
toggleBtn.Size = UDim2.new(0, 100, 0, 30)
toggleBtn.Position = UDim2.new(0, 10, 0.85, 0)
toggleBtn.Text = "Toggle GUI"
toggleBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 14
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(0, 8)

-- Khung to chiếm ~60% màn hình
local gui = Instance.new("Frame", mainGui)
gui.Size = UDim2.new(0.6, 0, 0.6, 0)
gui.Position = UDim2.new(0.2, 0, 0.2, 0)
gui.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
gui.BorderSizePixel = 0
gui.Active = true
gui.Draggable = true
Instance.new("UICorner", gui).CornerRadius = UDim.new(0, 14)

-- Toggle show/hide GUI
toggleBtn.MouseButton1Click:Connect(function()
    gui.Visible = not gui.Visible
end)

-- Tạo nút
local function CreateButton(text, posY)
	local btn = Instance.new("TextButton", gui)
	btn.Size = UDim2.new(1, -40, 0, 40)
	btn.Position = UDim2.new(0, 20, 0, posY)
	btn.Text = text
	btn.BackgroundColor3 = Color3.fromRGB(60, 130, 210)
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 16
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 10)
	return btn
end

-- Các trạng thái
local autoFarm, espOn, fruitESPOn, autoCollect = false, false, false, false

-- Các nút chức năng
local btnFarm = CreateButton("Auto Farm: OFF", 20)
local btnESP = CreateButton("ESP Người Chơi: OFF", 80)
local btnFruitESP = CreateButton("ESP Trái: OFF", 140)
local btnCollect = CreateButton("Auto Collect Trái: OFF", 200)

-- Logic các nút
btnFarm.MouseButton1Click:Connect(function()
	autoFarm = not autoFarm
	btnFarm.Text = autoFarm and "Auto Farm: ON" or "Auto Farm: OFF"
end)

btnESP.MouseButton1Click:Connect(function()
	espOn = not espOn
	btnESP.Text = espOn and "ESP Người Chơi: ON" or "ESP Người Chơi: OFF"
end)

btnFruitESP.MouseButton1Click:Connect(function()
	fruitESPOn = not fruitESPOn
	btnFruitESP.Text = fruitESPOn and "ESP Trái: ON" or "ESP Trái: OFF"
end)

btnCollect.MouseButton1Click:Connect(function()
	autoCollect = not autoCollect
	btnCollect.Text = autoCollect and "Auto Collect Trái: ON" or "Auto Collect Trái: OFF"
end)
