--[[ 
AUTO FARM BLOX FRUITS - FULL SEA 1 
Version RAW Split Part 1: GUI Init + Button Setup
]]

repeat task.wait() until game:IsLoaded()
if game.CoreGui:FindFirstChild("BFAuto") then game.CoreGui.BFAuto:Destroy() end

local plr = game.Players.LocalPlayer
local rs = game:GetService("RunService")
local ts = game:GetService("TweenService")
local vim = game:GetService("VirtualInputManager")
local rep = game:GetService("ReplicatedStorage")

-- GUI TOGGLE BUTTON
local mainGui = Instance.new("ScreenGui", game.CoreGui)
mainGui.Name = "BFAuto"

local toggleBtn = Instance.new("TextButton", mainGui)
toggleBtn.Size = UDim2.new(0, 100, 0, 30)
toggleBtn.Position = UDim2.new(0, 10, 0.85, 0)
toggleBtn.Text = "Toggle GUI"
toggleBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 14
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(0, 8)

-- GUI FRAME (BO GÓC - TO 60% MÀN)
local gui = Instance.new("Frame", mainGui)
gui.Size = UDim2.new(0.6, 0, 0.6, 0)
gui.Position = UDim2.new(0.2, 0, 0.2, 0)
gui.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
gui.BorderSizePixel = 0
gui.Active = true
gui.Draggable = true
gui.Visible = true
Instance.new("UICorner", gui).CornerRadius = UDim.new(0, 14)

toggleBtn.MouseButton1Click:Connect(function()
	gui.Visible = not gui.Visible
end)

-- Tạo các nút
local function CreateButton(text, posY)
	local btn = Instance.new("TextButton", gui)
	btn.Size = UDim2.new(1, -20, 0, 35)
	btn.Position = UDim2.new(0, 10, 0, posY)
	btn.Text = text
	btn.BackgroundColor3 = Color3.fromRGB(50, 120, 200)
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 14
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
	return btn
end

-- Các nút điều khiển
local btnFarm = CreateButton("Auto Farm: OFF", 10)
local btnESP = CreateButton("ESP Người Chơi: OFF", 60)
local btnFruitESP = CreateButton("ESP Trái: OFF", 110)
local btnCollect = CreateButton("Auto Collect Trái: OFF", 160)

-- Các biến trạng thái
getgenv().AutoFarm = false
getgenv().ESPOn = false
getgenv().FruitESPOn = false
getgenv().AutoCollect = false

btnFarm.MouseButton1Click:Connect(function()
	getgenv().AutoFarm = not getgenv().AutoFarm
	btnFarm.Text = getgenv().AutoFarm and "Auto Farm: ON" or "Auto Farm: OFF"
end)

btnESP.MouseButton1Click:Connect(function()
	getgenv().ESPOn = not getgenv().ESPOn
	btnESP.Text = getgenv().ESPOn and "ESP Người Chơi: ON" or "ESP Người Chơi: OFF"
end)

btnFruitESP.MouseButton1Click:Connect(function()
	getgenv().FruitESPOn = not getgenv().FruitESPOn
	btnFruitESP.Text = getgenv().FruitESPOn and "ESP Trái: ON" or "ESP Trái: OFF"
end)

btnCollect.MouseButton1Click:Connect(function()
	getgenv().AutoCollect = not getgenv().AutoCollect
	btnCollect.Text = getgenv().AutoCollect and "Auto Collect Trái: ON" or "Auto Collect Trái: OFF"
end)
--[[ 
AUTO FARM BLOX FRUITS - ESP + AUTO COLLECT
Version RAW Split Part 2
]]

-- Hàm tạo ESP
local function CreateESP(part, name, color, tagName)
	if not part:FindFirstChild(tagName) then
		local tag = Instance.new("BillboardGui", part)
		tag.Name = tagName
		tag.Size = UDim2.new(0, 100, 0, 40)
		tag.StudsOffset = Vector3.new(0, 2, 0)
		tag.AlwaysOnTop = true

		local txt = Instance.new("TextLabel", tag)
		txt.Size = UDim2.new(1, 0, 1, 0)
		txt.Text = name
		txt.TextColor3 = color
		txt.TextSize = 9
		txt.Font = Enum.Font.Gotham
		txt.BackgroundTransparency = 1
	end
end

task.spawn(function()
	while task.wait(1) do
		-- ESP người chơi
		for _, p in pairs(game.Players:GetPlayers()) do
			if p ~= plr and p.Character and p.Character:FindFirstChild("Head") then
				local head = p.Character.Head
				if getgenv().ESPOn and not head:FindFirstChild("PlayerESP") then
					CreateESP(head, p.Name, Color3.fromRGB(0, 255, 0), "PlayerESP")
				elseif not getgenv().ESPOn and head:FindFirstChild("PlayerESP") then
					head:FindFirstChild("PlayerESP"):Destroy()
				end
			end
		end

		-- ESP trái + Auto Collect
		for _, v in pairs(workspace:GetChildren()) do
			if v:IsA("Tool") and v:FindFirstChild("Handle") and v.Handle:FindFirstChild("TouchInterest") then
				if getgenv().FruitESPOn and not v:FindFirstChild("FruitESP") then
					CreateESP(v.Handle, v.Name, Color3.fromRGB(255, 0, 0), "FruitESP")
				elseif not getgenv().FruitESPOn and v:FindFirstChild("FruitESP") then
					v:FindFirstChild("FruitESP"):Destroy()
				end
				if getgenv().AutoCollect and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
					local dist = (plr.Character.HumanoidRootPart.Position - v.Handle.Position).Magnitude
					if dist <= 50 then
						firetouchinterest(plr.Character.HumanoidRootPart, v.Handle, 0)
						task.wait()
						firetouchinterest(plr.Character.HumanoidRootPart, v.Handle, 1)
					end
				end
			end
		end
	end
end)
--[[ 
AUTO FARM BLOX FRUITS - AUTO CLICK + AUTO HAKI + BLOCK ẢO
Version RAW Split Part 3
]]

-- AUTO CLICK
task.spawn(function()
	while true do
		task.wait(0.1)
		if getgenv().AutoFarm and getgenv().Clicking then
			game:GetService("VirtualInputManager"):SendMouseButtonEvent(0, 0, 0, true, game, 0)
			task.wait()
			game:GetService("VirtualInputManager"):SendMouseButtonEvent(0, 0, 0, false, game, 0)
		end
	end
end)

-- AUTO HAKI VĨNH VIỄN
task.spawn(function()
	while true do
		task.wait(6)
		pcall(function()
			game:GetService("ReplicatedStorage").Remotes.CommE:FireServer("Buso")
		end)
	end
end)

-- TẠO BLOCK ẢO DƯỚI CHÂN KHI TWEEN
function MakeTweenBlock()
	local existing = workspace:FindFirstChild("TweenBlock")
	if existing then return existing end
	local part = Instance.new("Part", workspace)
	part.Name = "TweenBlock"
	part.Anchored = true
	part.Transparency = 1
	part.Size = Vector3.new(10, 1, 10)
	part.CanCollide = true
	return part
end

function TweenTo(pos)
	local hrp = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
	if not hrp then return end

	local block = MakeTweenBlock()
	local tweenInfo = TweenInfo.new((hrp.Position - pos).Magnitude / 250, Enum.EasingStyle.Linear)
	local tween = ts:Create(hrp, tweenInfo, {CFrame = CFrame.new(pos)})
	tween:Play()

	-- Block ảo luôn dưới chân
	task.spawn(function()
		while tween.PlaybackState == Enum.PlaybackState.Playing do
			if hrp and block then
				block.Position = hrp.Position - Vector3.new(0, 3, 0)
			end
			task.wait()
		end
	end)

	tween.Completed:Wait()
end
-- PHẦN 4 + 5: GUI & CƠ CHẾ FARM TỐI ƯU
repeat task.wait() until game:IsLoaded()
if game.CoreGui:FindFirstChild("BFAuto") then game.CoreGui.BFAuto:Destroy() end

local plr = game.Players.LocalPlayer
local rs = game:GetService("RunService")
local ts = game:GetService("TweenService")
local vim = game:GetService("VirtualInputManager")
local rep = game:GetService("ReplicatedStorage")

-- GUI CHÍNH
local mainGui = Instance.new("ScreenGui", game.CoreGui)
mainGui.Name = "BFAuto"

local frame = Instance.new("Frame", mainGui)
frame.Size = UDim2.new(0.6, 0, 0.6, 0)
frame.Position = UDim2.new(0.2, 0, 0.2, 0)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.Active = true
frame.Draggable = true
frame.BorderSizePixel = 0
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 10)

local function CreateButton(text, posY)
	local btn = Instance.new("TextButton", frame)
	btn.Size = UDim2.new(1, -20, 0, 30)
	btn.Position = UDim2.new(0, 10, 0, posY)
	btn.Text = text
	btn.BackgroundColor3 = Color3.fromRGB(50, 120, 200)
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 14
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
	return btn
end

local btnFarm = CreateButton("Auto Farm: OFF", 10)

local autoFarm = false
btnFarm.MouseButton1Click:Connect(function()
	autoFarm = not autoFarm
	btnFarm.Text = autoFarm and "Auto Farm: ON" or "Auto Farm: OFF"
end)

-- BLOCK ẢO DƯỚI CHÂN
local function MakePlatUnder(pos)
	local plat = workspace:FindFirstChild("BFPlat") or Instance.new("Part", workspace)
	plat.Name = "BFPlat"
	plat.Anchored = true
	plat.CanCollide = true
	plat.Transparency = 1
	plat.Size = Vector3.new(10, 1, 10)
	plat.Position = pos - Vector3.new(0, 3, 0)
end

-- TWEEN MƯỢT + BLOCK
local function SmoothTween(pos)
	local hrp = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
	if not hrp then return end
	MakePlatUnder(hrp.Position)
	local distance = (hrp.Position - pos).Magnitude
	local tween = ts:Create(hrp, TweenInfo.new(distance / 200, Enum.EasingStyle.Linear), {CFrame = CFrame.new(pos)})
	tween:Play()
	tween.Completed:Wait()
end

-- CLICK ẢO
local function ClickAttack()
	vim:SendMouseButtonEvent(0, 0, 0, true, game, 0)
	task.wait()
	vim:SendMouseButtonEvent(0, 0, 0, false, game, 0)
end

-- HÀNH ĐỘNG FARM
task.spawn(function()
	while task.wait() do
		if autoFarm then
			local data = getgenv().BF_LevelFarm
			if not data then continue end
			local char = plr.Character
			local hrp = char and char:FindFirstChild("HumanoidRootPart")
			if not hrp then continue end

			-- TWEEN tới đảo
			SmoothTween(data.Pos)
			task.wait(2.5)

			-- KIỂM TRA QUEST
			local guiQuest = plr.PlayerGui:FindFirstChild("Main") and plr.PlayerGui.Main:FindFirstChild("Quest")
			local hasQuest = guiQuest and guiQuest.Visible

			if not hasQuest then
				ClickAttack() -- Tắt auto click để tránh đè bảng
				SmoothTween(data.QuestPos)
				task.wait(0.3)
				rep.Remotes.CommF_:InvokeServer("StartQuest", data.Quest, 1)
				task.wait(0.5)
			end
		else
			if workspace:FindFirstChild("BFPlat") then workspace.BFPlat:Destroy() end
		end
	end
end)
-- ĐÁNH QUÁI - FARM LIÊN TỤC KHÔNG BỊ GIÁN ĐOẠN
local function GetMob()
	local region = workspace.Enemies:GetChildren()
	for _, mob in pairs(region) do
		if mob:FindFirstChild("HumanoidRootPart") and mob:FindFirstChild("Humanoid") then
			if mob.Name == getgenv().BF_LevelFarm.Mob then
				if mob.Humanoid.Health > 0 then
					return mob
				end
			end
		end
	end
end

-- Hitbox và đứng yên
local function EnhanceMob(mob)
	for _,v in ipairs(mob:GetChildren()) do
		if v:IsA("BasePart") then
			v.Size = Vector3.new(60, 60, 60)
			v.Transparency = 0.2
			v.Anchored = true
		end
	end
end

-- Auto Attack
task.spawn(function()
	while task.wait(0.15) do
		if autoFarm and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
			local mob = GetMob()
			if mob then
				EnhanceMob(mob)

				local mobPos = mob.HumanoidRootPart.Position + Vector3.new(0, 10, 0)
				ts:Create(plr.Character.HumanoidRootPart, TweenInfo.new(0.5, Enum.EasingStyle.Linear), {
					CFrame = CFrame.new(mobPos)
				}):Play()

				ClickAttack()
			else
				-- Nếu không tìm thấy quái, không làm gì cả
			end
		end
	end
end)
