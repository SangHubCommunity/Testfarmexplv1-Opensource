--[[ 
AUTO FARM BLOX FRUITS - FULL SEA 1 
Version RAW Split Part 1: GUI Init + Button Setup
]]

repeat task.wait() until game:IsLoaded()
if game.CoreGui:FindFirstChild("BFAuto") then game.CoreGui.BFAuto:Destroy() end

local plr = game.Players.LocalPlayer
local rs = game:GetService("RunService")
local ts = game:GetService("TweenService")
local vim = game:GetService("VirtualInputManager")
local rep = game:GetService("ReplicatedStorage")

-- GUI TOGGLE BUTTON
local mainGui = Instance.new("ScreenGui", game.CoreGui)
mainGui.Name = "BFAuto"

local toggleBtn = Instance.new("TextButton", mainGui)
toggleBtn.Size = UDim2.new(0, 100, 0, 30)
toggleBtn.Position = UDim2.new(0, 10, 0.85, 0)
toggleBtn.Text = "Toggle GUI"
toggleBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 14
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(0, 8)

-- GUI FRAME (BO G√ìC - TO 60% M√ÄN)
local gui = Instance.new("Frame", mainGui)
gui.Size = UDim2.new(0.6, 0, 0.6, 0)
gui.Position = UDim2.new(0.2, 0, 0.2, 0)
gui.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
gui.BorderSizePixel = 0
gui.Active = true
gui.Draggable = true
gui.Visible = true
Instance.new("UICorner", gui).CornerRadius = UDim.new(0, 14)

toggleBtn.MouseButton1Click:Connect(function()
	gui.Visible = not gui.Visible
end)

-- T·∫°o c√°c n√∫t
local function CreateButton(text, posY)
	local btn = Instance.new("TextButton", gui)
	btn.Size = UDim2.new(1, -20, 0, 35)
	btn.Position = UDim2.new(0, 10, 0, posY)
	btn.Text = text
	btn.BackgroundColor3 = Color3.fromRGB(50, 120, 200)
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 14
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
	return btn
end

-- C√°c n√∫t ƒëi·ªÅu khi·ªÉn
local btnFarm = CreateButton("Auto Farm: OFF", 10)
local btnESP = CreateButton("ESP Ng∆∞·ªùi Ch∆°i: OFF", 60)
local btnFruitESP = CreateButton("ESP Tr√°i: OFF", 110)
local btnCollect = CreateButton("Auto Collect Tr√°i: OFF", 160)

-- C√°c bi·∫øn tr·∫°ng th√°i
getgenv().AutoFarm = false
getgenv().ESPOn = false
getgenv().FruitESPOn = false
getgenv().AutoCollect = false

btnFarm.MouseButton1Click:Connect(function()
	getgenv().AutoFarm = not getgenv().AutoFarm
	btnFarm.Text = getgenv().AutoFarm and "Auto Farm: ON" or "Auto Farm: OFF"
end)

btnESP.MouseButton1Click:Connect(function()
	getgenv().ESPOn = not getgenv().ESPOn
	btnESP.Text = getgenv().ESPOn and "ESP Ng∆∞·ªùi Ch∆°i: ON" or "ESP Ng∆∞·ªùi Ch∆°i: OFF"
end)

btnFruitESP.MouseButton1Click:Connect(function()
	getgenv().FruitESPOn = not getgenv().FruitESPOn
	btnFruitESP.Text = getgenv().FruitESPOn and "ESP Tr√°i: ON" or "ESP Tr√°i: OFF"
end)

btnCollect.MouseButton1Click:Connect(function()
	getgenv().AutoCollect = not getgenv().AutoCollect
	btnCollect.Text = getgenv().AutoCollect and "Auto Collect Tr√°i: ON" or "Auto Collect Tr√°i: OFF"
end)
--[[ 
AUTO FARM BLOX FRUITS - ESP + AUTO COLLECT
Version RAW Split Part 2
]]

-- H√†m t·∫°o ESP
local function CreateESP(part, name, color, tagName)
	if not part:FindFirstChild(tagName) then
		local tag = Instance.new("BillboardGui", part)
		tag.Name = tagName
		tag.Size = UDim2.new(0, 100, 0, 40)
		tag.StudsOffset = Vector3.new(0, 2, 0)
		tag.AlwaysOnTop = true

		local txt = Instance.new("TextLabel", tag)
		txt.Size = UDim2.new(1, 0, 1, 0)
		txt.Text = name
		txt.TextColor3 = color
		txt.TextSize = 9
		txt.Font = Enum.Font.Gotham
		txt.BackgroundTransparency = 1
	end
end

task.spawn(function()
	while task.wait(1) do
		-- ESP ng∆∞·ªùi ch∆°i
		for _, p in pairs(game.Players:GetPlayers()) do
			if p ~= plr and p.Character and p.Character:FindFirstChild("Head") then
				local head = p.Character.Head
				if getgenv().ESPOn and not head:FindFirstChild("PlayerESP") then
					CreateESP(head, p.Name, Color3.fromRGB(0, 255, 0), "PlayerESP")
				elseif not getgenv().ESPOn and head:FindFirstChild("PlayerESP") then
					head:FindFirstChild("PlayerESP"):Destroy()
				end
			end
		end

		-- ESP tr√°i + Auto Collect
		for _, v in pairs(workspace:GetChildren()) do
			if v:IsA("Tool") and v:FindFirstChild("Handle") and v.Handle:FindFirstChild("TouchInterest") then
				if getgenv().FruitESPOn and not v:FindFirstChild("FruitESP") then
					CreateESP(v.Handle, v.Name, Color3.fromRGB(255, 0, 0), "FruitESP")
				elseif not getgenv().FruitESPOn and v:FindFirstChild("FruitESP") then
					v:FindFirstChild("FruitESP"):Destroy()
				end
				if getgenv().AutoCollect and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
					local dist = (plr.Character.HumanoidRootPart.Position - v.Handle.Position).Magnitude
					if dist <= 50 then
						firetouchinterest(plr.Character.HumanoidRootPart, v.Handle, 0)
						task.wait()
						firetouchinterest(plr.Character.HumanoidRootPart, v.Handle, 1)
					end
				end
			end
		end
	end
end)
--[[ 
AUTO FARM BLOX FRUITS - AUTO CLICK + AUTO HAKI + BLOCK ·∫¢O
Version RAW Split Part 3
]]

-- AUTO CLICK
task.spawn(function()
	while true do
		task.wait(0.1)
		if getgenv().AutoFarm and getgenv().Clicking then
			game:GetService("VirtualInputManager"):SendMouseButtonEvent(0, 0, 0, true, game, 0)
			task.wait()
			game:GetService("VirtualInputManager"):SendMouseButtonEvent(0, 0, 0, false, game, 0)
		end
	end
end)

-- AUTO HAKI Vƒ®NH VI·ªÑN
task.spawn(function()
	while true do
		task.wait(6)
		pcall(function()
			game:GetService("ReplicatedStorage").Remotes.CommE:FireServer("Buso")
		end)
	end
end)

-- T·∫†O BLOCK ·∫¢O D∆Ø·ªöI CH√ÇN KHI TWEEN
function MakeTweenBlock()
	local existing = workspace:FindFirstChild("TweenBlock")
	if existing then return existing end
	local part = Instance.new("Part", workspace)
	part.Name = "TweenBlock"
	part.Anchored = true
	part.Transparency = 1
	part.Size = Vector3.new(10, 1, 10)
	part.CanCollide = true
	return part
end

function TweenTo(pos)
	local hrp = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
	if not hrp then return end

	local block = MakeTweenBlock()
	local tweenInfo = TweenInfo.new((hrp.Position - pos).Magnitude / 250, Enum.EasingStyle.Linear)
	local tween = ts:Create(hrp, tweenInfo, {CFrame = CFrame.new(pos)})
	tween:Play()

	-- Block ·∫£o lu√¥n d∆∞·ªõi ch√¢n
	task.spawn(function()
		while tween.PlaybackState == Enum.PlaybackState.Playing do
			if hrp and block then
				block.Position = hrp.Position - Vector3.new(0, 3, 0)
			end
			task.wait()
		end
	end)

	tween.Completed:Wait()
end
-- PH·∫¶N 4 + 5: GUI & C∆† CH·∫æ FARM T·ªêI ∆ØU
repeat task.wait() until game:IsLoaded()
if game.CoreGui:FindFirstChild("BFAuto") then game.CoreGui.BFAuto:Destroy() end

local plr = game.Players.LocalPlayer
local rs = game:GetService("RunService")
local ts = game:GetService("TweenService")
local vim = game:GetService("VirtualInputManager")
local rep = game:GetService("ReplicatedStorage")

-- GUI CH√çNH
local mainGui = Instance.new("ScreenGui", game.CoreGui)
mainGui.Name = "BFAuto"

local frame = Instance.new("Frame", mainGui)
frame.Size = UDim2.new(0.6, 0, 0.6, 0)
frame.Position = UDim2.new(0.2, 0, 0.2, 0)
frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
frame.Active = true
frame.Draggable = true
frame.BorderSizePixel = 0
Instance.new("UICorner", frame).CornerRadius = UDim.new(0, 10)

local function CreateButton(text, posY)
	local btn = Instance.new("TextButton", frame)
	btn.Size = UDim2.new(1, -20, 0, 30)
	btn.Position = UDim2.new(0, 10, 0, posY)
	btn.Text = text
	btn.BackgroundColor3 = Color3.fromRGB(50, 120, 200)
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 14
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
	return btn
end

local btnFarm = CreateButton("Auto Farm: OFF", 10)

local autoFarm = false
btnFarm.MouseButton1Click:Connect(function()
	autoFarm = not autoFarm
	btnFarm.Text = autoFarm and "Auto Farm: ON" or "Auto Farm: OFF"
end)

-- BLOCK ·∫¢O D∆Ø·ªöI CH√ÇN
local function MakePlatUnder(pos)
	local plat = workspace:FindFirstChild("BFPlat") or Instance.new("Part", workspace)
	plat.Name = "BFPlat"
	plat.Anchored = true
	plat.CanCollide = true
	plat.Transparency = 1
	plat.Size = Vector3.new(10, 1, 10)
	plat.Position = pos - Vector3.new(0, 3, 0)
end

-- TWEEN M∆Ø·ª¢T + BLOCK
local function SmoothTween(pos)
	local hrp = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
	if not hrp then return end
	MakePlatUnder(hrp.Position)
	local distance = (hrp.Position - pos).Magnitude
	local tween = ts:Create(hrp, TweenInfo.new(distance / 200, Enum.EasingStyle.Linear), {CFrame = CFrame.new(pos)})
	tween:Play()
	tween.Completed:Wait()
end

-- CLICK ·∫¢O
local function ClickAttack()
	vim:SendMouseButtonEvent(0, 0, 0, true, game, 0)
	task.wait()
	vim:SendMouseButtonEvent(0, 0, 0, false, game, 0)
end

-- H√ÄNH ƒê·ªòNG FARM
task.spawn(function()
	while task.wait() do
		if autoFarm then
			local data = getgenv().BF_LevelFarm
			if not data then continue end
			local char = plr.Character
			local hrp = char and char:FindFirstChild("HumanoidRootPart")
			if not hrp then continue end

			-- TWEEN t·ªõi ƒë·∫£o
			SmoothTween(data.Pos)
			task.wait(2.5)

			-- KI·ªÇM TRA QUEST
			local guiQuest = plr.PlayerGui:FindFirstChild("Main") and plr.PlayerGui.Main:FindFirstChild("Quest")
			local hasQuest = guiQuest and guiQuest.Visible

			if not hasQuest then
				ClickAttack() -- T·∫Øt auto click ƒë·ªÉ tr√°nh ƒë√® b·∫£ng
				SmoothTween(data.QuestPos)
				task.wait(0.3)
				rep.Remotes.CommF_:InvokeServer("StartQuest", data.Quest, 1)
				task.wait(0.5)
			end
		else
			if workspace:FindFirstChild("BFPlat") then workspace.BFPlat:Destroy() end
		end
	end
end)
-- ƒê√ÅNH QU√ÅI - FARM LI√äN T·ª§C KH√îNG B·ªä GI√ÅN ƒêO·∫†N
local function GetMob()
	local region = workspace.Enemies:GetChildren()
	for _, mob in pairs(region) do
		if mob:FindFirstChild("HumanoidRootPart") and mob:FindFirstChild("Humanoid") then
			if mob.Name == getgenv().BF_LevelFarm.Mob then
				if mob.Humanoid.Health > 0 then
					return mob
				end
			end
		end
	end
end

-- Hitbox v√† ƒë·ª©ng y√™n
local function EnhanceMob(mob)
	for _,v in ipairs(mob:GetChildren()) do
		if v:IsA("BasePart") then
			v.Size = Vector3.new(60, 60, 60)
			v.Transparency = 0.2
			v.Anchored = true
		end
	end
end

-- Auto Attack
task.spawn(function()
	while task.wait(0.15) do
		if autoFarm and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
			local mob = GetMob()
			if mob then
				EnhanceMob(mob)

				local mobPos = mob.HumanoidRootPart.Position + Vector3.new(0, 10, 0)
				ts:Create(plr.Character.HumanoidRootPart, TweenInfo.new(0.5, Enum.EasingStyle.Linear), {
					CFrame = CFrame.new(mobPos)
				}):Play()

				ClickAttack()
			else
				-- N·∫øu kh√¥ng t√¨m th·∫•y qu√°i, kh√¥ng l√†m g√¨ c·∫£
			end
		end
	end
end)
-- ESP + AUTO COLLECT + AUTO HAKI
local function CreateESP(obj, text, color, name)
	local tag = Instance.new("BillboardGui", obj)
	tag.Name = name
	tag.Size = UDim2.new(0, 100, 0, 40)
	tag.StudsOffset = Vector3.new(0, 2, 0)
	tag.AlwaysOnTop = true

	local lbl = Instance.new("TextLabel", tag)
	lbl.Size = UDim2.new(1, 0, 1, 0)
	lbl.Text = text
	lbl.TextColor3 = color
	lbl.TextSize = 10
	lbl.BackgroundTransparency = 1
end

task.spawn(function()
	while task.wait(1) do
		-- ESP ng∆∞·ªùi ch∆°i
		for _, v in pairs(game.Players:GetPlayers()) do
			if v ~= plr and v.Character and v.Character:FindFirstChild("Head") then
				local head = v.Character.Head
				if espOn and not head:FindFirstChild("ESP") then
					CreateESP(head, v.Name, Color3.fromRGB(0, 255, 0), "ESP")
				elseif not espOn and head:FindFirstChild("ESP") then
					head:FindFirstChild("ESP"):Destroy()
				end
			end
		end

		-- ESP + Auto Collect tr√°i
		for _,v in pairs(workspace:GetChildren()) do
			if v:IsA("Tool") and v:FindFirstChild("Handle") then
				local handle = v:FindFirstChild("Handle")
				if fruitESPOn and not v:FindFirstChild("FruitESP") then
					CreateESP(v, v.Name, Color3.fromRGB(255, 0, 0), "FruitESP")
				elseif not fruitESPOn and v:FindFirstChild("FruitESP") then
					v:FindFirstChild("FruitESP"):Destroy()
				end

				-- Auto collect khi g·∫ßn
				if autoCollect and (plr.Character.HumanoidRootPart.Position - handle.Position).Magnitude < 60 then
					firetouchinterest(plr.Character.HumanoidRootPart, handle, 0)
					firetouchinterest(plr.Character.HumanoidRootPart, handle, 1)
				end
			end
		end
	end
end)

-- AUTO B·∫¨T HAKI M√ÉI M√ÉI
task.spawn(function()
	while true do
		task.wait(5)
		rep.Remotes.CommE:FireServer("Buso")
	end
end)
-- DANH S√ÅCH C√ÅC ƒê·∫¢O SEA 1 (C·∫ßn th√™m ƒë·ªß h·∫øt n·∫øu b·∫°n mu·ªën full Sea 1)
getgenv().BF_LevelFarm = {
	[1] = {Quest="BanditQuest1",Mob="Bandit",Pos=Vector3.new(1060,17,1547),QuestPos=Vector3.new(1060,17,1545)},
	[10] = {Quest="JungleQuest",Mob="Monkey",Pos=Vector3.new(-1602,36,153),QuestPos=Vector3.new(-1602,36,155)},
	-- Th√™m ƒë·∫ßy ƒë·ªß c√°c level ti·∫øp theo ·ªü Sea 1...
}

-- H√ÄM L·∫§Y ƒê·∫¢O THEO LEVEL
local function GetTarget()
	local level = plr.Data.Level.Value
	local last
	for lv, data in pairs(getgenv().BF_LevelFarm) do
		if level >= lv then
			last = data
		end
	end
	return last
end

-- TWEEN M∆Ø·ª¢T + BLOCK ·∫¢O B√ÅM THEO NG∆Ø·ªúI
local function TweenTo(pos)
	local char = plr.Character
	if not char or not char:FindFirstChild("HumanoidRootPart") then return end

	local hrp = char.HumanoidRootPart
	local distance = (hrp.Position - pos).Magnitude
	local tweenTime = distance / 250
	local tween = ts:Create(hrp, TweenInfo.new(tweenTime, Enum.EasingStyle.Linear), {CFrame = CFrame.new(pos)})
	
	-- BLOCK ·∫¢O CH·ªêNG R∆†I
	local followBlock = Instance.new("Part", workspace)
	followBlock.Size = Vector3.new(10,1,10)
	followBlock.Anchored = true
	followBlock.CanCollide = true
	followBlock.Transparency = 1
	followBlock.Name = "BF_Block"
	
	local con = rs.Heartbeat:Connect(function()
		if hrp and followBlock then
			followBlock.Position = hrp.Position - Vector3.new(0, 3.2, 0)
		end
	end)

	tween:Play()
	tween.Completed:Wait()
	con:Disconnect()
	if followBlock then followBlock:Destroy() end
end

-- L√ÄM TO HITBOX + ƒê√à QU√ÅI XU·ªêNG
local function PrepareMob(mob)
	for _,v in ipairs(mob:GetChildren()) do
		if v:IsA("BasePart") then
			v.Size = Vector3.new(60,60,60)
			v.Transparency = 0.2
		end
	end

	if mob:FindFirstChild("HumanoidRootPart") then
		local anchor = Instance.new("Part", mob)
		anchor.Anchored = true
		anchor.Transparency = 1
		anchor.CanCollide = true
		anchor.Size = Vector3.new(8, 1, 8)
		anchor.Position = mob.HumanoidRootPart.Position - Vector3.new(0, 3, 0)
	end
end
-- NH·∫¨N QUEST TH√îNG MINH
local function HasQuest()
	return plr.PlayerGui:FindFirstChild("QuestGUI") and plr.PlayerGui.QuestGUI.Enabled
end

local function IsQuestDone()
	if HasQuest() then
		local txt = plr.PlayerGui.QuestGUI.QuestBoard.QuestTitle.Title.Text
		local found = txt:match("(%d+)/(%d+)")
		if found then
			local current, goal = txt:match("(%d+)/(%d+)")
			return tonumber(current) >= tonumber(goal)
		end
	end
	return false
end

local function AcceptQuest()
	local target = GetTarget()
	if not target then return end
	if not HasQuest() or IsQuestDone() then
		TweenTo(target.QuestPos)
		task.wait(0.5)
		rep.Remotes.CommQuest:InvokeServer("StartQuest", target.Quest, 1)
	end
end

-- FARM TH√îNG MINH
task.spawn(function()
	while task.wait(0.5) do
		if autoFarm then
			local target = GetTarget()
			if not target then continue end
			if not HasQuest() or IsQuestDone() then
				AcceptQuest()
			end

			local mobList = workspace.Enemies:GetChildren()
			for _,mob in pairs(mobList) do
				if mob:FindFirstChild("HumanoidRootPart") and mob.Name == target.Mob then
					if mob.Humanoid.Health > 0 then
						PrepareMob(mob)
						repeat
							local hrp = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
							if hrp and mob:FindFirstChild("HumanoidRootPart") then
								local mobPos = mob.HumanoidRootPart.Position + Vector3.new(0, 12, 0)
								TweenTo(mobPos)
							end
							task.wait(0.2)
						until mob.Humanoid.Health <= 0 or not autoFarm
					end
				end
			end
		end
	end
end)

-- AUTO CLICK TR√ÅNH BUG
task.spawn(function()
	while task.wait(0.15) do
		if autoFarm and plr.Character and plr.Character:FindFirstChild("HumanoidRootPart") then
			local nearNPC = false
			for _,v in pairs(workspace:GetDescendants()) do
				if v:IsA("ClickDetector") and (v.Parent.Position - plr.Character.HumanoidRootPart.Position).Magnitude < 10 then
					nearNPC = true
					break
				end
			end
			if not nearNPC then
				ClickAttack()
			end
		end
	end
end)
-- PH·∫¶N 8: GUI ch√≠nh to h∆°n + fix l·ªói GUI b·ªã tr√πng
repeat task.wait() until game:IsLoaded()

-- X√≥a GUI c≈© n·∫øu c√≥
pcall(function()
	if game.CoreGui:FindFirstChild("BFAuto") then
		game.CoreGui.BFAuto:Destroy()
	end
end)

-- T·∫°o GUI ch√≠nh
local mainGui = Instance.new("ScreenGui")
mainGui.Name = "BFAuto"
mainGui.Parent = game.CoreGui
mainGui.ResetOnSpawn = false

-- N√∫t Toggle GUI
local toggleBtn = Instance.new("TextButton", mainGui)
toggleBtn.Size = UDim2.new(0, 100, 0, 30)
toggleBtn.Position = UDim2.new(0, 10, 0.85, 0)
toggleBtn.Text = "Toggle GUI"
toggleBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 14
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(0, 8)

-- Khung GUI ch√≠nh - to h∆°n v√† bo g√≥c ƒë·∫πp
local guiFrame = Instance.new("Frame", mainGui)
guiFrame.Name = "MainFrame"
guiFrame.Size = UDim2.new(0.6, 0, 0.6, 0) -- Chi·∫øm 60% m√†n h√¨nh
guiFrame.Position = UDim2.new(0.2, 0, 0.2, 0)
guiFrame.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
guiFrame.BorderSizePixel = 0
guiFrame.Active = true
guiFrame.Draggable = true
guiFrame.Visible = true
Instance.new("UICorner", guiFrame).CornerRadius = UDim.new(0, 12)

-- Toggle GUI b·∫±ng n√∫t
toggleBtn.MouseButton1Click:Connect(function()
	guiFrame.Visible = not guiFrame.Visible
end)
-- D·ªØ li·ªáu Sea 1 (ch·ªâ l√† v√≠ d·ª•, b·∫°n c·∫ßn nh·∫≠p th√™m n·∫øu mu·ªën full ƒë·∫£o)
getgenv().BF_LevelFarm = {
	[1] = {Quest="BanditQuest1",Mob="Bandit",Pos=Vector3.new(1060,17,1547),QuestPos=Vector3.new(1060,17,1545)},
	[10] = {Quest="JungleQuest",Mob="Monkey",Pos=Vector3.new(-1602,36,153),QuestPos=Vector3.new(-1602,36,155)},
	-- Th√™m ƒë·∫ßy ƒë·ªß ƒë·∫£o ·ªü Sea 1 t·∫°i ƒë√¢y...
}

local function GetTarget()
	local level = plr.Data.Level.Value
	local last
	for lv, data in pairs(getgenv().BF_LevelFarm) do
		if level >= lv then last = data end
	end
	return last
end

local function TweenTo(pos)
	local hrp = plr.Character and plr.Character:FindFirstChild("HumanoidRootPart")
	if not hrp then return end

	-- T·∫°o block ·∫£o theo
	local fake = Instance.new("Part", workspace)
	fake.Anchored = true
	fake.CanCollide = true
	fake.Transparency = 1
	fake.Size = Vector3.new(10, 1, 10)
	fake.Position = hrp.Position - Vector3.new(0,3,0)
	fake.Name = "TweenPlat"
	
	local ti = TweenInfo.new((hrp.Position - pos).Magnitude/200, Enum.EasingStyle.Linear)
	local tween = ts:Create(hrp, ti, {CFrame = CFrame.new(pos)})
	tween:Play()
	tween.Completed:Wait()

	fake:Destroy()
end

task.spawn(function()
	local lastQuest = ""
	while true do
		task.wait()
		if autoFarm then
			local data = GetTarget()
			if not data then continue end

			local char = plr.Character
			local hrp = char and char:FindFirstChild("HumanoidRootPart")
			if not hrp then continue end

			-- ƒê·∫øn v·ªã tr√≠ ƒë·∫£o farm
			TweenTo(data.Pos)
			task.wait(1)

			-- Ki·ªÉm tra quest
			local questUI = plr.PlayerGui:FindFirstChild("Main") and plr.PlayerGui.Main:FindFirstChild("Quest")
			local hasQuest = questUI and questUI.Visible
			local finished = false

			-- N·∫øu ch∆∞a c√≥ quest -> ƒë·∫øn NPC l·∫•y
			if not hasQuest then
				TweenTo(data.QuestPos)
				task.wait(0.3)
				rep.Remotes.CommF_:InvokeServer("StartQuest", data.Quest, 1)
				task.wait(1)
			end

			-- Farm qu√°i
			while autoFarm and not finished do
				local found = false
				for _, mob in pairs(workspace.Enemies:GetChildren()) do
					if mob.Name == data.Mob and mob:FindFirstChild("HumanoidRootPart") and mob:FindFirstChild("Humanoid") and mob.Humanoid.Health > 0 then
						found = true
						local root = mob.HumanoidRootPart
						
						-- Hitbox to v√† ƒë√® qu√°i xu·ªëng
						for _, part in ipairs(mob:GetChildren()) do
							if part:IsA("BasePart") then
								part.Size = Vector3.new(60,60,60)
								part.Transparency = 0.2
							end
						end
						root.CanCollide = false

						local above = root.Position + Vector3.new(0, 10, 0)
						local plat = Instance.new("Part", root)
						plat.Anchored = true
						plat.CanCollide = true
						plat.Transparency = 1
						plat.Size = Vector3.new(8,1,8)
						plat.Position = above
						plat.Name = "FarmPlat"

						-- Farm loop
						repeat
							TweenTo(above + Vector3.new(0,1,0)) -- Tween li√™n t·ª•c tr√™n ƒë·∫ßu
							task.wait(0.15)
						until not autoFarm or mob.Humanoid.Health <= 0 or not mob.Parent

						plat:Destroy()
					end
				end
				-- Ki·ªÉm tra nhi·ªám v·ª• ho√†n th√†nh ch∆∞a
				finished = not questUI or not questUI.Visible
				if not found then task.wait(0.5) end
			end

			-- N·∫øu ho√†n th√†nh nhi·ªám v·ª• th√¨ quay l·∫°i nh·∫≠n ti·∫øp
			if autoFarm and finished then
				TweenTo(data.QuestPos)
				task.wait(0.5)
				rep.Remotes.CommF_:InvokeServer("StartQuest", data.Quest, 1)
			end
		end
	end
end)
-- GUI Toggle
local mainGui = Instance.new("ScreenGui", game.CoreGui)
mainGui.Name = "BFAuto"

local toggleBtn = Instance.new("TextButton", mainGui)
toggleBtn.Size = UDim2.new(0, 100, 0, 30)
toggleBtn.Position = UDim2.new(0, 10, 0.85, 0)
toggleBtn.Text = "Toggle GUI"
toggleBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
toggleBtn.TextColor3 = Color3.new(1, 1, 1)
toggleBtn.Font = Enum.Font.GothamBold
toggleBtn.TextSize = 14
Instance.new("UICorner", toggleBtn).CornerRadius = UDim.new(0, 8)

local gui = Instance.new("Frame", mainGui)
gui.Size = UDim2.new(0.6, 0, 0.6, 0)
gui.Position = UDim2.new(0.2, 0, 0.2, 0)
gui.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
gui.BorderSizePixel = 0
gui.Active = true
gui.Draggable = true
Instance.new("UICorner", gui).CornerRadius = UDim.new(0, 14)

toggleBtn.MouseButton1Click:Connect(function()
    gui.Visible = not gui.Visible
end)

-- N√∫t ch·ª©c nƒÉng
local function CreateButton(text, posY)
	local btn = Instance.new("TextButton", gui)
	btn.Size = UDim2.new(1, -20, 0, 30)
	btn.Position = UDim2.new(0, 10, 0, posY)
	btn.Text = text
	btn.BackgroundColor3 = Color3.fromRGB(50, 120, 200)
	btn.TextColor3 = Color3.new(1, 1, 1)
	btn.Font = Enum.Font.Gotham
	btn.TextSize = 14
	Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 8)
	return btn
end

local btnFarm = CreateButton("Auto Farm: OFF", 10)
local btnESP = CreateButton("ESP Ng∆∞·ªùi Ch∆°i: OFF", 50)
local btnFruitESP = CreateButton("ESP Tr√°i: OFF", 90)
local btnCollect = CreateButton("Auto Collect Tr√°i: OFF", 130)

local autoFarm, espOn, fruitESPOn, autoCollect = false, false, false, false

btnFarm.MouseButton1Click:Connect(function()
	autoFarm = not autoFarm
	btnFarm.Text = autoFarm and "Auto Farm: ON" or "Auto Farm: OFF"
end)

btnESP.MouseButton1Click:Connect(function()
	espOn = not espOn
	btnESP.Text = espOn and "ESP Ng∆∞·ªùi Ch∆°i: ON" or "ESP Ng∆∞·ªùi Ch∆°i: OFF"
end)

btnFruitESP.MouseButton1Click:Connect(function()
	fruitESPOn = not fruitESPOn
	btnFruitESP.Text = fruitESPOn and "ESP Tr√°i: ON" or "ESP Tr√°i: OFF"
end)

btnCollect.MouseButton1Click:Connect(function()
	autoCollect = not autoCollect
	btnCollect.Text = autoCollect and "Auto Collect Tr√°i: ON" or "Auto Collect Tr√°i: OFF"
end)

-- Auto Click
local vim = game:GetService("VirtualInputManager")
task.spawn(function()
	while task.wait(0.25) do
		if autoFarm then
			vim:SendMouseButtonEvent(0, 0, 0, true, game, 0)
			task.wait()
			vim:SendMouseButtonEvent(0, 0, 0, false, game, 0)
		end
	end
end)

-- Auto Haki b·∫≠t vƒ©nh vi·ªÖn
local rep = game:GetService("ReplicatedStorage")
task.spawn(function()
	while true do
		task.wait(4)
		pcall(function()
			rep.Remotes.CommE:FireServer("Buso")
		end)
	end
end)

-- ESP & Collect tr√°i √°c qu·ª∑
local plr = game.Players.LocalPlayer
task.spawn(function()
	while task.wait(1) do
		for _, v in pairs(workspace:GetChildren()) do
			if v:IsA("Tool") and v:FindFirstChild("Handle") and v.Handle:FindFirstChild("TouchInterest") then
				-- ESP Fruit
				if fruitESPOn and not v:FindFirstChild("FruitESP") then
					local tag = Instance.new("BillboardGui", v)
					tag.Name = "FruitESP"
					tag.Size = UDim2.new(0, 100, 0, 40)
					tag.StudsOffset = Vector3.new(0, 2, 0)
					tag.AlwaysOnTop = true
					
					local txt = Instance.new("TextLabel", tag)
					txt.Size = UDim2.new(1, 0, 1, 0)
					txt.Text = v.Name
					txt.TextColor3 = Color3.fromRGB(255, 0, 0)
					txt.TextSize = 9
					txt.BackgroundTransparency = 1
				elseif not fruitESPOn and v:FindFirstChild("FruitESP") then
					v.FruitESP:Destroy()
				end
				
				-- Auto Collect
				if autoCollect and (v.Handle.Position - plr.Character.HumanoidRootPart.Position).Magnitude < 30 then
					firetouchinterest(plr.Character.HumanoidRootPart, v.Handle, 0)
					firetouchinterest(plr.Character.HumanoidRootPart, v.Handle, 1)
				end
			end
		end
		
		-- ESP Player
		for _, player in pairs(game.Players:GetPlayers()) do
			if player ~= plr and player.Character and player.Character:FindFirstChild("Head") then
				local head = player.Character.Head
				if espOn and not head:FindFirstChild("PlayerESP") then
					local tag = Instance.new("BillboardGui", head)
					tag.Name = "PlayerESP"
					tag.Size = UDim2.new(0, 100, 0, 40)
					tag.StudsOffset = Vector3.new(0, 2, 0)
					tag.AlwaysOnTop = true

					local txt = Instance.new("TextLabel", tag)
					txt.Size = UDim2.new(1, 0, 1, 0)
					txt.Text = player.Name
					txt.TextColor3 = Color3.fromRGB(0, 255, 0)
					txt.TextSize = 9
					txt.BackgroundTransparency = 1
				elseif not espOn and head:FindFirstChild("PlayerESP") then
					head.PlayerESP:Destroy()
				end
			end
		end
	end
end)
-- WELCOME TO SANG HUB - POPUP
local StarterGui = game:GetService("StarterGui")

StarterGui:SetCore("SendNotification", {
	Title = "üéâ C·∫£m ∆°n b·∫°n ƒë√£ s·ª≠ d·ª•ng Sang Hub!";
	Text = "üèÜ Th√†nh t·ª±u: Welcome To Sang Hub";
	Duration = 6;
})
